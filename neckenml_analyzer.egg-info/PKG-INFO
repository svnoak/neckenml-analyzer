Metadata-Version: 2.4
Name: neckenml-analyzer
Version: 0.1.0
Summary: Swedish folk music audio analysis and dance style classification
Author: NeckenML Analyzer Contributors
License: MIT
Project-URL: Homepage, https://github.com/svnoak/neckenml-analyzer
Project-URL: Documentation, https://github.com/svnoak/neckenml-analyzer/blob/main/README.md
Project-URL: Repository, https://github.com/svnoak/neckenml-analyzer
Project-URL: Issues, https://github.com/svnoak/neckenml-analyzer/issues
Keywords: audio,music,folk,swedish,classification,dance,analysis
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: Multimedia :: Sound/Audio :: Analysis
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Requires-Python: >=3.9
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: numpy>=1.20.0
Requires-Dist: scikit-learn>=1.0.0
Requires-Dist: joblib>=1.0.0
Requires-Dist: sqlalchemy>=2.0.0
Requires-Dist: psycopg2-binary>=2.9.0
Provides-Extra: audio
Requires-Dist: essentia-tensorflow>=2.1b6.dev0; extra == "audio"
Requires-Dist: librosa>=0.9.0; extra == "audio"
Requires-Dist: madmom>=0.16.0; extra == "audio"
Requires-Dist: soundfile>=0.10.0; extra == "audio"
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=3.0.0; extra == "dev"
Requires-Dist: black>=22.0.0; extra == "dev"
Requires-Dist: flake8>=4.0.0; extra == "dev"
Dynamic: license-file

# NeckenML Analyzer

Swedish folk music audio analysis and dance style classification using machine learning.

## Overview

NeckenML Analyzer is a Python package that provides advanced audio analysis and automatic dance style classification for Swedish folk music. It uses a combination of signal processing, machine learning, and domain-specific heuristics to:

- **Analyze audio features**: BPM, meter (ternary/binary), swing ratio, vocal presence, articulation, bounciness, and more
- **Classify dance styles**: Polska, Hambo, Vals, Polka, Schottis, Snoa, and other Swedish folk dance types
- **Assess authenticity**: Distinguish traditional folk recordings from modern/electronic interpretations

## Features

- **Comprehensive Audio Analysis**
  - Tempo and beat detection using Essentia
  - Meter classification (3/4 ternary vs 2/4/4/4 binary)
  - MusiCNN embeddings for audio texture fingerprinting
  - Vocal vs instrumental detection
  - Swing ratio calculation
  - Articulation analysis (smooth/staccato/punchy)
  - Folk-specific features (Polska vs Hambo signatures)

- **Machine Learning Classification**
  - Pre-trained RandomForest classifier included
  - Hierarchical decision-making (metadata → ML → heuristics)
  - Confidence scores for each prediction
  - Support for model retraining with custom data

- **Extensible Architecture**
  - Abstract `AudioSource` interface for flexible audio acquisition
  - Built-in file-based source
  - Easy to implement custom sources (S3, HTTP, streaming, etc.)

## Installation

### 1. Install the package

```bash
pip install neckenml-analyzer
```

### 2. Set up PostgreSQL

neckenml Analyzer uses PostgreSQL with the pgvector extension for storing embeddings:

```bash
# Create database
createdb neckenml

# Enable pgvector extension
psql neckenml -c "CREATE EXTENSION vector;"
```

### 3. Download pre-trained models

The analyzer requires Essentia's MusiCNN models (not included due to licensing):

```bash
# Create models directory
mkdir -p ~/.neckenml/models

# Download MusiCNN embedding model
wget https://essentia.upf.edu/models/feature-extractors/musicnn/msd-musicnn-1.pb \
  -O ~/.neckenml/models/msd-musicnn-1.pb

# Download voice/instrumental classifier
wget https://essentia.upf.edu/models/audio-event-recognition/voice_instrumental/voice_instrumental-musicnn-msd-1.pb \
  -O ~/.neckenml/models/voice_instrumental-musicnn-msd-1.pb
```

## Quick Start

```python
from neckenml import AudioAnalyzer, StyleClassifier
from neckenml.sources import FileAudioSource

# Set up audio source (file-based)
source = FileAudioSource(audio_dir="/path/to/your/audio/files")

# Initialize analyzer with audio source
analyzer = AudioAnalyzer(
    audio_source=source,
    model_dir="~/.neckenml/models"  # Optional, uses default if not specified
)

# Analyze an audio file (track_id should match filename without extension)
features = analyzer.analyze(track_id="my_track")

# The features dict contains:
# - bpm: Tempo in beats per minute
# - meter: 'ternary' or 'binary'
# - swing_ratio: 0.0-1.0 (0.5 = straight, 0.67 = triplet feel)
# - vocal_probability: 0.0-1.0 (vocal vs instrumental)
# - embedding: 217-dimensional feature vector
# - and many more...

# Classify dance style
classifier = StyleClassifier()
result = classifier.classify(features)

print(f"Detected style: {result['primary_style']}")
print(f"Confidence: {result['confidence']:.1%}")
print(f"Secondary styles: {result['secondary_styles']}")

# Example output:
# Detected style: Polska
# Confidence: 85.0%
# Secondary styles: [('Slängpolska', 0.65)]
```

## Advanced Usage

### Custom Audio Source

Implement the `AudioSource` interface for custom audio acquisition:

```python
from neckenml.sources import AudioSource

class S3AudioSource(AudioSource):
    """Fetch audio from AWS S3"""

    def __init__(self, bucket_name, region='us-east-1'):
        self.s3 = boto3.client('s3', region_name=region)
        self.bucket = bucket_name

    def fetch_audio(self, track_id: str) -> str:
        """Download audio file from S3 and return local path"""
        local_path = f"/tmp/{track_id}.mp3"
        self.s3.download_file(
            Bucket=self.bucket,
            Key=f"audio/{track_id}.mp3",
            Filename=local_path
        )
        return local_path

    def cleanup(self, file_path: str) -> None:
        """Clean up temporary file"""
        if os.path.exists(file_path):
            os.remove(file_path)

# Use custom source
source = S3AudioSource(bucket_name="my-music-bucket")
analyzer = AudioAnalyzer(audio_source=source)
```

### Retraining the Classifier

Train a custom model with your own labeled data:

```python
from neckenml.training import TrainingService
import numpy as np

# Prepare training data
embeddings = np.array([...])  # Nx217 feature vectors from analyzer
labels = ["Polska", "Hambo", "Polska", ...]  # Dance style labels

# Train new model
trainer = TrainingService(model_path="./my_custom_model.pkl")
trainer.train_from_data(embeddings, labels)

# The classifier will automatically use the new model
```

## Supported Dance Styles

**Ternary (3/4 meter):**
- Polska
- Slängpolska
- Hambo
- Vals (Waltz)
- Springlek
- Mazurka

**Binary (2/4, 4/4 meter):**
- Polka
- Schottis
- Snoa
- Gånglåt
- Engelska
- Marsch

## Documentation

- [Installation Guide](docs/installation.md) - Detailed setup instructions
- [Quick Start](docs/quickstart.md) - Getting started examples
- [Extending](docs/extending.md) - Custom AudioSource implementations and model training

## Architecture

neckenml Analyzer uses a multi-stage pipeline:

1. **Audio Acquisition**: Flexible `AudioSource` interface
2. **Feature Extraction**: Essentia + Madmom for signal processing
3. **Embedding Generation**: MusiCNN for 200-dim audio fingerprints
4. **Folk Features**: Domain-specific rhythm and meter analysis
5. **Classification**: Hierarchical decision tree (metadata → ML → heuristics)

## Requirements

- Python 3.9+
- PostgreSQL with pgvector extension
- Essentia pre-trained models (see installation instructions)

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

MIT License - see [LICENSE](LICENSE) file for details.

## Citation

If you use neckenml Analyzer in your research, please cite:

```bibtex
@software{neckenml_analyzer,
  title = {neckenml Analyzer: Swedish Folk Music Analysis and Classification},
  author = {neckenml Contributors},
  year = {2025},
  url = {https://github.com/svnoak/neckenml-analyzer}
}
```

## Acknowledgments

- Built with [Essentia](https://essentia.upf.edu/) audio analysis library
- MusiCNN models by Jordi Pons et al.
- Powered by the Swedish folk music community
